# ì½”ë“œ ìµœì í™” ìš”ì•½

MCP ë„êµ¬ë“¤ì„ í™œìš©í•œ ì½”ë“œ ê²€í†  ë° ìµœì í™” ì‘ì—… ì™„ë£Œ ë³´ê³ ì„œ

## âœ… ì™„ë£Œëœ ìµœì í™” í•­ëª©

### 1. Next.js Cloudflare Pages ìµœì í™”

#### ë³€ê²½ ì‚¬í•­
- `@cloudflare/next-on-pages` íŒ¨í‚¤ì§€ ì¶”ê°€
- ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ ìµœì í™”: `cf:build`, `cf:dev`, `cf:deploy`
- Next.js ì„¤ì • ìµœì í™”:
  - `reactStrictMode: true` í™œì„±í™”
  - `swcMinify: true` í™œì„±í™”
  - `compress: true` í™œì„±í™”
  - `poweredByHeader: false` (ë³´ì•ˆ ê°•í™”)
  - ë³´ì•ˆ í—¤ë” ì¶”ê°€ (X-Content-Type-Options, X-Frame-Options ë“±)
  - íŒ¨í‚¤ì§€ ì„í¬íŠ¸ ìµœì í™” (`optimizePackageImports`)

#### íŒŒì¼
- `package.json`: Cloudflare ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ ë° ì˜ì¡´ì„± ì¶”ê°€
- `next.config.mjs`: Cloudflare Pages ìµœì í™” ì„¤ì •

### 2. D1 ë°ì´í„°ë² ì´ìŠ¤ ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”

#### ë³€ê²½ ì‚¬í•­
- êµ¬ì¡°í™”ëœ ë¡œê¹… ì‹œìŠ¤í…œ í†µí•©
- ì¿¼ë¦¬ ì‹¤íŒ¨ ì‹œ ìƒì„¸í•œ ì—ëŸ¬ ì •ë³´ ë¡œê¹…
- `success` í”Œë˜ê·¸ ê²€ì¦ ì¶”ê°€
- ì¬ì‹œë„ ìœ í‹¸ë¦¬í‹° ì¶”ê°€ (`lib/db/retry.ts`)

#### íŒŒì¼
- `lib/db/d1-client.ts`: ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹… ê°œì„ 
- `lib/db/retry.ts`: ì¬ì‹œë„ ë¡œì§ ìœ í‹¸ë¦¬í‹° (ì‹ ê·œ)

### 3. í¬ë¡  ì‘ì—… ìµœì í™”

#### ë³€ê²½ ì‚¬í•­
- êµ¬ì¡°í™”ëœ ë¡œê¹… ì‹œìŠ¤í…œ ì ìš©
- ì‹¤í–‰ ì‹œê°„ ì¸¡ì • ë° ë¡œê¹…
- ì—ëŸ¬ ë°œìƒ ì‹œ ìƒì„¸ ì»¨í…ìŠ¤íŠ¸ ë¡œê¹…
- Rate limit ì—ëŸ¬ ì²˜ë¦¬ ê°œì„  (ì¬ì‹œë„ ë°©ì§€)

#### íŒŒì¼
- `workers/cron-daily.ts`: ë¡œê¹… ë° ì—ëŸ¬ í•¸ë“¤ë§ ê°œì„ 
- `workers/cron-hourly.ts`: ë¡œê¹… ë° ì—ëŸ¬ í•¸ë“¤ë§ ê°œì„ 
- `functions/api/cron/daily.ts`: êµ¬ì¡°í™”ëœ ì—ëŸ¬ ë¡œê¹…
- `functions/api/cron/hourly.ts`: êµ¬ì¡°í™”ëœ ì—ëŸ¬ ë¡œê¹…

### 4. í”„ë¡œë•ì…˜ ë¡œê¹… ìµœì í™”

#### ë³€ê²½ ì‚¬í•­
- êµ¬ì¡°í™”ëœ ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶• (`lib/logger.ts`)
- í™˜ê²½ë³„ ë¡œê¹… ë ˆë²¨ ì œì–´:
  - ê°œë°œ í™˜ê²½: ëª¨ë“  ë¡œê·¸ ì¶œë ¥
  - í”„ë¡œë•ì…˜ í™˜ê²½: warn, errorë§Œ ì¶œë ¥
- íƒ€ì„ìŠ¤íƒ¬í”„ ë° ì»¨í…ìŠ¤íŠ¸ ì •ë³´ í¬í•¨
- ëª¨ë“  `console.log/error`ë¥¼ êµ¬ì¡°í™”ëœ ë¡œê±°ë¡œ êµì²´

#### íŒŒì¼
- `lib/logger.ts`: êµ¬ì¡°í™”ëœ ë¡œê¹… ì‹œìŠ¤í…œ (ì‹ ê·œ)
- `app/api/usage/route.ts`: ë¡œê±° ì ìš©
- `app/api/stats/route.ts`: ë¡œê±° ì ìš©
- `lib/analytics-cloudflare.ts`: ë¡œê±° ì ìš©

### 5. ì—ëŸ¬ ë°”ìš´ë”ë¦¬ ë° ì—ëŸ¬ ë¦¬í¬íŒ… ê°œì„ 

#### ë³€ê²½ ì‚¬í•­
- ì—ëŸ¬ ë°”ìš´ë”ë¦¬ì— ì—ëŸ¬ ë¦¬í¬íŒ… ê¸°ëŠ¥ ì¶”ê°€
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ìë™ ì—ëŸ¬ ìˆ˜ì§‘
- ì—ëŸ¬ ë¦¬í¬íŒ… API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ (`/api/errors`)
- ì—ëŸ¬ ì •ë³´ êµ¬ì¡°í™” (ìŠ¤íƒ, ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ, ì‚¬ìš©ì ì •ë³´ ë“±)

#### íŒŒì¼
- `components/error-boundary.tsx`: ì—ëŸ¬ ë¦¬í¬íŒ… ì¶”ê°€
- `app/error.tsx`: ì—ëŸ¬ ë¦¬í¬íŒ… ì¶”ê°€
- `app/api/errors/route.ts`: ì—ëŸ¬ ìˆ˜ì§‘ API (ì‹ ê·œ)

### 6. ì„±ëŠ¥ ìµœì í™”

#### ë³€ê²½ ì‚¬í•­
- ì´ë¯¸ì§€ í¬ë§· ìµœì í™” (WebP, AVIF)
- íŒ¨í‚¤ì§€ ì„í¬íŠ¸ ìµœì í™”
- Gzip ì••ì¶• í™œì„±í™”
- ë³´ì•ˆ í—¤ë” ìµœì í™”

## ğŸ“Š ê°œì„  ì§€í‘œ

### ì½”ë“œ í’ˆì§ˆ
- âœ… íƒ€ì… ì•ˆì •ì„±: `any` íƒ€ì… ì œê±° ì™„ë£Œ
- âœ… ì—ëŸ¬ í•¸ë“¤ë§: ëª¨ë“  ì£¼ìš” ê²½ë¡œì— ì—ëŸ¬ í•¸ë“¤ë§ ì¶”ê°€
- âœ… ë¡œê¹…: êµ¬ì¡°í™”ëœ ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶•
- âœ… ë¬¸ì„œí™”: JSDoc ì£¼ì„ ì¶”ê°€

### ì„±ëŠ¥
- âœ… ë²ˆë“¤ í¬ê¸°: íŒ¨í‚¤ì§€ ì„í¬íŠ¸ ìµœì í™”
- âœ… ì´ë¯¸ì§€: ìµœì‹  í¬ë§· ì§€ì›
- âœ… ì••ì¶•: Gzip í™œì„±í™”
- âœ… ìºì‹±: Cloudflare Pages ìë™ ìºì‹± í™œìš©

### ë³´ì•ˆ
- âœ… í—¤ë”: ë³´ì•ˆ í—¤ë” ì¶”ê°€
- âœ… ë¡œê¹…: ë¯¼ê° ì •ë³´ ì œì™¸
- âœ… ì—ëŸ¬: í”„ë¡œë•ì…˜ ì—ëŸ¬ ì •ë³´ êµ¬ì¡°í™”

## ğŸ”§ ì¶”ê°€ ê¶Œì¥ ì‚¬í•­

### ë‹¨ê¸° (1-2ì£¼)
1. **ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ í†µí•©**
   - Sentry ë˜ëŠ” LogRocket ì—°ë™
   - ì—ëŸ¬ ì•Œë¦¼ ì„¤ì •

2. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**
   - Web Vitals ì¶”ì 
   - Cloudflare Analytics í™œì„±í™”

3. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±**
   - D1 ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
   - í¬ë¡  ì‘ì—… í…ŒìŠ¤íŠ¸

### ì¤‘ê¸° (1-2ê°œì›”)
1. **ìºì‹± ì „ëµ ê°œì„ **
   - ISR (Incremental Static Regeneration) êµ¬í˜„
   - API ì‘ë‹µ ìºì‹±

2. **ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”**
   - ì¿¼ë¦¬ ì¸ë±ìŠ¤ ìµœì í™”
   - ì¿¼ë¦¬ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

3. **ë²ˆë“¤ ë¶„ì„**
   - ë²ˆë“¤ í¬ê¸° ë¶„ì„ ë„êµ¬ ë„ì…
   - ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… ìµœì í™”

## ğŸ“ ì‚¬ìš© ê°€ì´ë“œ

### ë¡œê¹… ì‚¬ìš©ë²•

```typescript
import { logger } from "@/lib/logger"

// ì •ë³´ ë¡œê·¸ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ)
logger.info("Operation completed", { userId: "123" })

// ê²½ê³  ë¡œê·¸
logger.warn("Rate limit approaching", { usage: 80 })

// ì—ëŸ¬ ë¡œê·¸
logger.error("Database query failed", error, { query: "SELECT * FROM users" })
```

### ì¬ì‹œë„ ë¡œì§ ì‚¬ìš©ë²•

```typescript
import { retryD1Query } from "@/lib/db/retry"

const result = await retryD1Query(async () => {
  return await db.prepare("SELECT * FROM users").all()
})
```

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. `npm install` ì‹¤í–‰í•˜ì—¬ ìƒˆë¡œìš´ ì˜ì¡´ì„± ì„¤ì¹˜
2. `npm run cf:build` í…ŒìŠ¤íŠ¸
3. í”„ë¡œë•ì…˜ í™˜ê²½ì— ë°°í¬
4. ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ì„¤ì •
5. ì„±ëŠ¥ ì§€í‘œ ëª¨ë‹ˆí„°ë§

